<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        h2 {
            color: #3498db;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .input-section, .output-section {
            margin-bottom: 30px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        textarea {
            width: 100%;
            height: 250px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: background-color 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        #parseBtn {
            background-color: #2ecc71;
        }
        
        #parseBtn:hover {
            background-color: #27ae60;
        }
        
        #downloadBtn {
            background-color: #e74c3c;
            display: none;
        }
        
        #downloadBtn:hover {
            background-color: #c0392b;
        }
        
        #clearBtn {
            background-color: #95a5a6;
        }
        
        #clearBtn:hover {
            background-color: #7f8c8d;
        }
        
        #jsonOutput {
            background-color: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            max-height: 500px;
            overflow-y: auto;
            display: none;
        }
        
        .status {
            margin-top: 15px;
            padding: 12px 15px;
            border-radius: 6px;
            display: none;
        }
        
        .success {
            background-color: #d5edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            flex: 1;
            min-width: 150px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 14px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h1>
        
        <div class="input-section">
            <h2>–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
            <p>–í—Å—Ç–∞–≤—å—Ç–µ HTML-–∫–æ–¥ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –ø–æ–ª–µ –Ω–∏–∂–µ (–∫–∞–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ):</p>
            
            <label for="htmlInput">HTML-–∫–æ–¥ —ç–ª–µ–º–µ–Ω—Ç–∞:</label>
            <textarea id="htmlInput" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ HTML-–∫–æ–¥ —Å—é–¥–∞..."></textarea>
            
            <div class="button-group">
                <button id="parseBtn">
                    <span>üìä</span> –ü–∞—Ä—Å–∏—Ç—å HTML
                </button>
                <button id="clearBtn">
                    <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å
                </button>
                <button id="downloadBtn">
                    <span>‚¨áÔ∏è</span> –°–∫–∞—á–∞—Ç—å JSON
                </button>
            </div>
            
            <div id="status" class="status"></div>
        </div>
        
        <div class="output-section">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
            
            <div class="stats" id="stats">
                <div class="stat-box">
                    <div class="stat-value" id="classCount">0</div>
                    <div class="stat-label">–ö–ª–∞—Å—Å–æ–≤</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="subjectCount">0</div>
                    <div class="stat-label">–ü—Ä–µ–¥–º–µ—Ç–æ–≤</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="parallelCount">0</div>
                    <div class="stat-label">–ü–∞—Ä–∞–ª–ª–µ–ª–µ–π</div>
                </div>
            </div>
            
            <label for="jsonOutput">–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON:</label>
            <pre id="jsonOutput"></pre>
        </div>
    </div>
    
    <footer>
        <p>–°–æ–∑–¥–∞–Ω–æ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–∑ HTML-–∫–æ–¥–∞ —ç–ª–µ–º–µ–Ω—Ç–∞</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const htmlInput = document.getElementById('htmlInput');
            const jsonOutput = document.getElementById('jsonOutput');
            const parseBtn = document.getElementById('parseBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const clearBtn = document.getElementById('clearBtn');
            const statusDiv = document.getElementById('status');
            const classCount = document.getElementById('classCount');
            const subjectCount = document.getElementById('subjectCount');
            const parallelCount = document.getElementById('parallelCount');
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
            function showStatus(message, type = 'info') {
                statusDiv.textContent = message;
                statusDiv.className = `status ${type}`;
                statusDiv.style.display = 'block';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    if (statusDiv.textContent === message) {
                        statusDiv.style.display = 'none';
                    }
                }, 5000);
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
            function parseHTML() {
                const html = htmlInput.value.trim();
                
                if (!html) {
                    showStatus('–í–≤–µ–¥–∏—Ç–µ HTML-–∫–æ–¥ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞', 'error');
                    return;
                }
                
                try {
                    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;
                    
                    // –ë–∞–∑–æ–≤—ã–π URL
                    const baseURL = "https://authedu.mosreg.ru/teacher/study-process/journal/grade/";
                    
                    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–ª–∞—Å—Å–æ–≤
                    const classCards = tempDiv.querySelectorAll('[data-test-component="journalCardRoute"]');
                    
                    if (classCards.length === 0) {
                        showStatus('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ –æ –∫–ª–∞—Å—Å–∞—Ö –≤ HTML', 'error');
                        return;
                    }
                    
                    const result = {
                        baseURL: baseURL,
                        classes: []
                    };
                    
                    let totalSubjects = 0;
                    const parallels = new Set();
                    
                    // –ü–∞—Ä—Å–∏–º –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å
                    classCards.forEach(card => {
                        // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞
                        const classNameElement = card.querySelector('.S1UsQhVOrZV2UWrhV1Iv span');
                        if (!classNameElement) return;
                        
                        const className_orig = classNameElement.textContent.trim();
                        const className = className_orig.replace(" –∫–ª–∞—Å—Å", "");
                        // –ù–∞—Ö–æ–¥–∏–º –ø–∞—Ä–∞–ª–ª–µ–ª—å (–µ—Å–ª–∏ –µ—Å—Ç—å)
                        const parallelSection = card.closest('section[data-test-component^="journalListSection-"]');
                        if (parallelSection) {
                            const parallelHeader = parallelSection.querySelector('h6');
                            if (parallelHeader) {
                                parallels.add(parallelHeader.textContent.trim());
                            }
                        }
                        
                        // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞
                        const subjectLinks = card.querySelectorAll('a[data-test-component^="journalCardRoute-"]');
                        const subjects = [];
                        
                        subjectLinks.forEach(link => {
                            const subjectNameElement = link.querySelector('.pn6BPJgprcoctbDs2w0J span');
                            if (!subjectNameElement) return;
                            
                            const subjectName = subjectNameElement.textContent.trim();

                            // –ò–∑–≤–ª–µ–∫–∞–µ–º ID –∏–∑ href –∏–ª–∏ data-test-component
                            const href = link.getAttribute('href');
                            let subjectId = '';
                            
                            if (href) {
                                // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å ID –∏–∑ URL
                                const idMatch = href.match(/\/grade\/(\d+)/);
                                if (idMatch && idMatch[1]) {
                                    subjectId = idMatch[1];
                                }
                            }
                            
                            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –∏–∑ href, –ø—Ä–æ–±—É–µ–º –∏–∑ data-test-component
                            if (!subjectId) {
                                const dataTest = link.getAttribute('data-test-component');
                                if (dataTest) {
                                    const idMatch = dataTest.match(/_(\d+)$/);
                                    if (idMatch && idMatch[1]) {
                                        subjectId = idMatch[1];
                                    }
                                }
                            }
                            
                            if (subjectName && subjectId) {
                                subjects.push({
                                    name: subjectName,
                                    ID: subjectId
                                });
                                totalSubjects++;
                            }
                        });
                        
                        if (className && subjects.length > 0) {
                            result.classes.push({
                                name: className,
                                journals: subjects
                            });
                        }
                    });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    classCount.textContent = result.classes.length;
                    subjectCount.textContent = totalSubjects;
                    parallelCount.textContent = parallels.size;
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º JSON –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    jsonOutput.textContent = JSON.stringify(result, null, 2);
                    jsonOutput.style.display = 'block';
                    downloadBtn.style.display = 'flex';
                    
                    showStatus(`–£—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: ${result.classes.length} –∫–ª–∞—Å—Å–æ–≤, ${totalSubjects} –ø—Ä–µ–¥–º–µ—Ç–æ–≤, ${parallels.size} –ø–∞—Ä–∞–ª–ª–µ–ª–µ–π`, 'success');
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ HTML:', error);
                    showStatus(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ: ${error.message}`, 'error');
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è JSON
            function downloadJSON() {
                const jsonStr = jsonOutput.textContent;
                
                if (!jsonStr) {
                    showStatus('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è', 'error');
                    return;
                }
                
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON
                    JSON.parse(jsonStr);
                    
                    const blob = new Blob([jsonStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'classes_data.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showStatus('JSON —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω', 'success');
                } catch (error) {
                    showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è', 'error');
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª–µ–π
            function clearFields() {
                htmlInput.value = '';
                jsonOutput.textContent = '';
                jsonOutput.style.display = 'none';
                downloadBtn.style.display = 'none';
                statusDiv.style.display = 'none';
                
                // –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                classCount.textContent = '0';
                subjectCount.textContent = '0';
                parallelCount.textContent = '0';
                
                showStatus('–í—Å–µ –ø–æ–ª—è –æ—á–∏—â–µ–Ω—ã', 'info');
            }
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            parseBtn.addEventListener('click', parseHTML);
            downloadBtn.addEventListener('click', downloadJSON);
            clearBtn.addEventListener('click', clearFields);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ HTML (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            htmlInput.addEventListener('paste', function() {
                setTimeout(() => {
                    // –ü–∞—Ä—Å–∏–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª–µ –Ω–µ –ø—É—Å—Ç–æ–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ—â–µ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω
                    if (htmlInput.value.trim() && jsonOutput.style.display === 'none') {
                        parseHTML();
                    }
                }, 500);
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            const exampleHTML = `<div>–í—Å—Ç–∞–≤—å—Ç–µ HTML-–∫–æ–¥ —Å—é–¥–∞. –ü—Ä–∏–º–µ—Ä: <div class="luxo64SuLYGU_cNq7glg" data-test-component="journalCardRoute"><div class="S1UsQhVOrZV2UWrhV1Iv"><span class="DSXOGdoSiFGKohRuaDDx ebIBbAN3ZomwnCMWP167 _ELGiVRWaoZZRQLlT7eO LqxH9tRjFX8eUgojIkc1 E8taxZlPjqlq_tc1djmu">1-–ê –∫–ª–∞—Å—Å</span></div><div class="LK6ph21ODerO9HUFgkvs"><a class="mo3i0By7o2f2M_Erhktw" data-test-component="journalCardRoute-33623629_2298989" href="/teacher/study-process/journal/grade/2298989?logon_source=teacher_study-process_journal_grade"><svg>...</svg><div class="pn6BPJgprcoctbDs2w0J"><span class="DSXOGdoSiFGKohRuaDDx ebIBbAN3ZomwnCMWP167 _ELGiVRWaoZZRQLlT7eO E8taxZlPjqlq_tc1djmu XOLQ67MNIr2weSGtGuZ5">–ò–∑–æ–±—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ</span></div></a></div></div></div>`;
            htmlInput.placeholder = exampleHTML;
            
            // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
            showStatus('–í—Å—Ç–∞–≤—å—Ç–µ HTML-–∫–æ–¥ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –ø–æ–ª–µ –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–∞—Ä—Å–∏—Ç—å HTML"', 'info');
        });
    </script>
</body>
</html>